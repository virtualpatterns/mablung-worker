{"version":3,"sources":["../../../../source/esmodule/test/library/worker-client.test.js"],"names":[],"mappings":"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","file":"worker-client.test.js","sourcesContent":["import Test from 'ava'\n\nimport { LoggedClient } from './logged-client.js'\nimport { WorkerClient } from '../../index.js'\n\nimport { WorkerClientDurationExceededError } from '../../index.js'\nimport { WorkerClientRejectedError } from '../../library/error/worker-client-rejected-error.js'\n\nconst Require = __require\n\nTest('new WorkerClient()', async (test) => {\n\n  let worker = null\n  \n  test.notThrows(() => { worker = new LoggedClient()})\n  await test.notThrowsAsync(worker.exit())\n\n})\n\nTest('new WorkerClient(path, option)', async (test) => {\n\n  let worker = null\n  \n  test.notThrows(() => { worker = new WorkerClient(Require.resolve('./worker.js'), { 'maximumDuration': 10000 })})\n  await test.notThrowsAsync(worker.exit())\n\n})\n\nTest('new WorkerClient(option, option)', async (test) => {\n\n  let worker = null\n  \n  test.notThrows(() => { worker = new WorkerClient({ '--import-path': Require.resolve('./worker.js') }, { 'maximumDuration': 10000 })})\n  await test.notThrowsAsync(worker.exit())\n\n})\n\nTest('new WorkerClient(path, option, option)', async (test) => {\n\n  let worker = null\n  \n  test.notThrows(() => { worker = new WorkerClient(Require.resolve('../../library/create-worker-server.js'), { '--import-path': Require.resolve('./worker.js') }, { 'maximumDuration': 10000 })})\n  await test.notThrowsAsync(worker.exit())\n\n})\n\nTest('WorkerClient.module.getPid()', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n    test.is(await worker.module.getPid(), worker.pid)\n  } finally {\n    await worker.exit()\n  }\n  \n})\n\nTest('WorkerClient._onPing(message)', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n    await test.notThrowsAsync(worker.ping())\n  } finally {\n    await worker.exit()\n  }\n\n})\n\nTest('WorkerClient._onApply(message)', async (test) => {\n\n  let worker = new WorkerClient(Require.resolve('./worker.js'))\n\n  try {\n    test.is(await worker.module.getPid(), worker.pid)\n  } finally {\n    await worker.exit()\n  }\n\n})\n\nTest('WorkerClient._onTerminate(signal)', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await test.notThrowsAsync(worker.ping()) // establishes is ready\n  await worker.kill()\n  await test.throwsAsync(worker.ping(), { 'code': 'ERR_IPC_CHANNEL_CLOSED' })\n\n})\n\nTest('WorkerClient.maximumDuration', async (test) => {\n\n  let maximumDuration = 10000\n  let worker = new WorkerClient({ 'maximumDuration': maximumDuration })\n\n  try {\n\n    test.is(worker.maximumDuration, maximumDuration)\n    test.is(worker.option.maximumDuration, maximumDuration)\n\n    worker.maximumDuration = maximumDuration = 5000\n\n    test.is(worker.maximumDuration, maximumDuration)\n    test.is(worker.option.maximumDuration, maximumDuration)\n\n  } finally {\n    await worker.exit()\n  }\n\n})\n\nTest('WorkerClient.module.getPid(duration) throws WorkerClientRejectedError', async (test) => {\n\n  let worker = new WorkerClient(Require.resolve('./worker.js'))\n\n  await test.throwsAsync(Promise.all([ worker.module.getPid(2500), worker.exit() ]), { 'instanceOf': WorkerClientRejectedError })\n\n})\n\nTest('WorkerClient.ping() throws WorkerClientDurationExceededError', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n\n    let maximumDuration = null\n    maximumDuration = worker.maximumDuration\n\n    worker.maximumDuration = 1    \n    await test.throwsAsync(worker.ping(), { 'instanceOf': WorkerClientDurationExceededError })\n    worker.maximumDuration = maximumDuration    \n\n  } finally {\n    await worker.exit()\n  }\n\n})\n\nTest('WorkerClient.exit() throws WorkerClientDurationExceededError', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await worker.ping() // establish ready\n\n  let maximumDuration = null\n  maximumDuration = worker.maximumDuration\n\n  worker.maximumDuration = 1    \n  await test.throwsAsync(worker.exit(), { 'instanceOf': WorkerClientDurationExceededError })\n  worker.maximumDuration = maximumDuration    \n\n})\n\nTest('WorkerClient.module.throwException(duration) throws WorkerExceptionError', async (test) => {\n\n  let worker = new WorkerClient(Require.resolve('./worker.js'))\n\n  try {\n    await test.throwsAsync(worker.module.throwException(), { 'message': 'WorkerExceptionError' })\n  } finally {\n    await worker.exit()\n  }\n\n})\n\nTest('WorkerClient.disconnect()', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await worker.ping() // establish ready\n  await test.notThrowsAsync(worker.disconnect())\n\n})\n\nTest('WorkerClient.module.then', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n    test.falsy(worker.module.then)\n  } finally {\n    await worker.exit()\n  }\n\n})\n"]}