{"version":3,"sources":["../../../source/test/library/worker-client.test.js"],"names":["Require","require","test","worker","notThrows","WorkerClient","notThrowsAsync","exit","resolve","is","module","getPid","pid","ping","kill","throwsAsync","maximumDuration","option","Promise","all","WorkerClientRejectedError","WorkerClientDurationExceededError","throwException","disconnect","falsy","then"],"mappings":"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","sourcesContent":["import Test from 'ava'\n\n// import { LoggedClient } from './logged-client.js'\nimport { WorkerClient } from '../../index.js'\n\nimport { WorkerClientDurationExceededError } from '../../index.js'\nimport { WorkerClientRejectedError } from '../../library/error/worker-client-rejected-error.js'\n\nconst Require = __require\n\nTest('new WorkerClient()', async (test) => {\n\n  let worker = null\n  \n  test.notThrows(() => { worker = new WorkerClient()})\n  await test.notThrowsAsync(worker.exit())\n\n})\n\nTest('new WorkerClient(path, option)', async (test) => {\n\n  let worker = null\n  \n  test.notThrows(() => { worker = new WorkerClient(Require.resolve('./worker.js'), { 'maximumDuration': 10000 })})\n  await test.notThrowsAsync(worker.exit())\n\n})\n\nTest('new WorkerClient(option, option)', async (test) => {\n\n  let worker = null\n  \n  test.notThrows(() => { worker = new WorkerClient({ '--import-path': Require.resolve('./worker.js') }, { 'maximumDuration': 10000 })})\n  await test.notThrowsAsync(worker.exit())\n\n})\n\nTest('new WorkerClient(path, option, option)', async (test) => {\n\n  let worker = null\n  \n  test.notThrows(() => { worker = new WorkerClient(Require.resolve('../../library/create-worker-server.js'), { '--import-path': Require.resolve('./worker.js') }, { 'maximumDuration': 10000 })})\n  await test.notThrowsAsync(worker.exit())\n\n})\n\nTest('WorkerClient.module.getPid()', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n    test.is(await worker.module.getPid(), worker.pid)\n  } finally {\n    await worker.exit()\n  }\n  \n})\n\nTest('WorkerClient._onPing(message)', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n    await test.notThrowsAsync(worker.ping())\n  } finally {\n    await worker.exit()\n  }\n\n})\n\nTest('WorkerClient._onApply(message)', async (test) => {\n\n  let worker = new WorkerClient(Require.resolve('./worker.js'))\n\n  try {\n    test.is(await worker.module.getPid(), worker.pid)\n  } finally {\n    await worker.exit()\n  }\n\n})\n\nTest('WorkerClient._onTerminate(signal)', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await test.notThrowsAsync(worker.ping()) // establishes is ready\n  await worker.kill()\n  await test.throwsAsync(worker.ping(), { 'code': 'ERR_IPC_CHANNEL_CLOSED' })\n\n})\n\nTest('WorkerClient.maximumDuration', async (test) => {\n\n  let maximumDuration = 10000\n  let worker = new WorkerClient({ 'maximumDuration': maximumDuration })\n\n  try {\n\n    test.is(worker.maximumDuration, maximumDuration)\n    test.is(worker.option.maximumDuration, maximumDuration)\n\n    worker.maximumDuration = maximumDuration = 5000\n\n    test.is(worker.maximumDuration, maximumDuration)\n    test.is(worker.option.maximumDuration, maximumDuration)\n\n  } finally {\n    await worker.exit()\n  }\n\n})\n\nTest('WorkerClient.module.getPid(duration) throws WorkerClientRejectedError', async (test) => {\n\n  let worker = new WorkerClient(Require.resolve('./worker.js'))\n\n  await test.throwsAsync(Promise.all([ worker.module.getPid(2500), worker.exit() ]), { 'instanceOf': WorkerClientRejectedError })\n\n})\n\nTest('WorkerClient.ping() throws WorkerClientDurationExceededError', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n\n    let maximumDuration = null\n    maximumDuration = worker.maximumDuration\n\n    worker.maximumDuration = 1    \n    await test.throwsAsync(worker.ping(), { 'instanceOf': WorkerClientDurationExceededError })\n    worker.maximumDuration = maximumDuration    \n\n  } finally {\n    await worker.exit()\n  }\n\n})\n\nTest('WorkerClient.exit() throws WorkerClientDurationExceededError', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await worker.ping() // establish ready\n\n  let maximumDuration = null\n  maximumDuration = worker.maximumDuration\n\n  worker.maximumDuration = 1    \n  await test.throwsAsync(worker.exit(), { 'instanceOf': WorkerClientDurationExceededError })\n  worker.maximumDuration = maximumDuration    \n\n})\n\nTest('WorkerClient.module.throwException(duration) throws WorkerExceptionError', async (test) => {\n\n  let worker = new WorkerClient(Require.resolve('./worker.js'))\n\n  try {\n    await test.throwsAsync(worker.module.throwException(), { 'message': 'WorkerExceptionError' })\n  } finally {\n    await worker.exit()\n  }\n\n})\n\nTest('WorkerClient.disconnect()', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await worker.ping() // establish ready\n  await test.notThrowsAsync(worker.disconnect())\n\n})\n\nTest('WorkerClient.module.then', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n    test.falsy(worker.module.then)\n  } finally {\n    await worker.exit()\n  }\n\n})\n"],"file":"worker-client.test.cjs"}