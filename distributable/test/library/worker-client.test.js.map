{"version":3,"sources":["../../../source/test/library/worker-client.test.js"],"names":["Test","LoggedClient","WorkerClient","WorkerClientDurationExceededError","WorkerClientRejectedError","Process","process","Require","_createRequire","import","meta","url","skip","test","worker","notThrowsAsync","ping","end","throwsAsync","kill","pid","resolve","is","Error","module","getPid","_getPid","release","Promise","all","maximumDuration","disconnect","uncaughtException","unhandledRejection"],"mappings":"yDAAA,OAAOA,IAAP,MAAiB,KAAjB;;AAEA,SAASC,YAAT,QAA6B,oBAA7B;AACA,SAASC,YAAT,QAA6B,gBAA7B;;AAEA,SAASC,iCAAT,QAAkD,gBAAlD;AACA,SAASC,yBAAT,QAA0C,qDAA1C;;AAEA,MAAMC,OAAO,GAAGC,OAAhB;AACA,MAAMC,OAAO,GATbC,cAAc,CAACC,MAAM,CAACC,IAAP,CAAYC,GAAb,CASd;;AAEAX,IAAI,CAACY,IAAL,CAAU,oBAAV,EAAgC,MAAOC,IAAP,IAAgB;;AAE9C,MAAIC,MAAM,GAAG,IAAIb,YAAJ,EAAb;;AAEA,MAAI;AACF,UAAMY,IAAI,CAACE,cAAL,CAAoBD,MAAM,CAACE,IAAP,EAApB,CAAN;AACD,GAFD,SAEU;AACR,UAAMF,MAAM,CAACG,GAAP,EAAN;AACD;;AAEF,CAVD;;AAYAjB,IAAI,CAACY,IAAL,CAAU,8DAAV,EAA0E,MAAOC,IAAP,IAAgB;;AAExF,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,CAAiB,EAAE,mBAAmB,CAArB,EAAjB,CAAb;;AAEA,MAAI;AACF,UAAMW,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACE,IAAP,EAAjB,EAAgC,EAAE,cAAcb,iCAAhB,EAAhC,CAAN;AACD,GAFD,SAEU;AACR;AACAE,IAAAA,OAAO,CAACc,IAAR,CAAaL,MAAM,CAACM,GAApB;AACD;;AAEF,CAXD;;AAaApB,IAAI,CAACY,IAAL,CAAU,0BAAV,EAAsC,MAAOC,IAAP,IAAgB;;AAEpD,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,MAAI;;AAEF,QAAIkB,GAAG,GAAG,MAAMN,MAAM,CAACL,MAAP,CAAcF,OAAO,CAACc,OAAR,CAAgB,aAAhB,CAAd,CAAhB;AACAR,IAAAA,IAAI,CAACS,EAAL,CAAQF,GAAR,EAAaN,MAAM,CAACM,GAApB;;AAEA,UAAMP,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACL,MAAP,CAAcF,OAAO,CAACc,OAAR,CAAgB,aAAhB,CAAd,CAAjB,EAAgE,EAAE,cAAcE,KAAhB,EAAhE,CAAN;AACAV,IAAAA,IAAI,CAACS,EAAL,CAAQ,MAAMR,MAAM,CAACU,MAAP,CAAcC,MAAd,EAAd,EAAsCX,MAAM,CAACM,GAA7C;;AAED,GARD,SAQU;AACR,UAAMN,MAAM,CAACG,GAAP,EAAN;AACD;;AAEF,CAhBD;;AAkBAjB,IAAI,CAACY,IAAL,CAAU,uCAAV,EAAmD,MAAOC,IAAP,IAAgB;;AAEjE,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,MAAI;;AAEF,UAAMY,MAAM,CAACL,MAAP,CAAcF,OAAO,CAACc,OAAR,CAAgB,aAAhB,CAAd,CAAN;;AAEA,UAAMR,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACU,MAAP,CAAcE,OAAd,EAAjB,EAA0C,EAAE,cAAcH,KAAhB,EAA1C,CAAN;;AAED,GAND,SAMU;AACR,UAAMT,MAAM,CAACG,GAAP,EAAN;AACD;;AAEF,CAdD;;AAgBAjB,IAAI,CAACY,IAAL,CAAU,wBAAV,EAAoC,MAAOC,IAAP,IAAgB;;AAElD,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,MAAI;;AAEF,QAAIkB,GAAG,GAAG,IAAV;AACAA,IAAAA,GAAG,GAAG,MAAMN,MAAM,CAACL,MAAP,CAAcF,OAAO,CAACc,OAAR,CAAgB,aAAhB,CAAd,CAAZ;AACAD,IAAAA,GAAG,GAAG,MAAMN,MAAM,CAACa,OAAP,EAAZ;;AAEAd,IAAAA,IAAI,CAACS,EAAL,CAAQF,GAAR,EAAaN,MAAM,CAACM,GAApB;AACAP,IAAAA,IAAI,CAACS,EAAL,CAAQR,MAAM,CAACU,MAAf,EAAuB,IAAvB;;AAED,GATD,SASU;AACR,UAAMV,MAAM,CAACG,GAAP,EAAN;AACD;;AAEF,CAjBD;;AAmBAjB,IAAI,CAACY,IAAL,CAAU,qCAAV,EAAiD,MAAOC,IAAP,IAAgB;;AAE/D,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,MAAI;;AAEF,UAAMY,MAAM,CAACL,MAAP,CAAcF,OAAO,CAACc,OAAR,CAAgB,aAAhB,CAAd,CAAN;AACA,UAAMP,MAAM,CAACa,OAAP,EAAN;;AAEA,UAAMd,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACa,OAAP,EAAjB,EAAmC,EAAE,cAAcJ,KAAhB,EAAnC,CAAN;;AAED,GAPD,SAOU;AACR,UAAMT,MAAM,CAACG,GAAP,EAAN;AACD;;AAEF,CAfD;;AAiBAjB,IAAI,CAACY,IAAL,CAAU,gEAAV,EAA4E,MAAOC,IAAP,IAAgB;;AAE1F,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,QAAMY,MAAM,CAACL,MAAP,CAAcF,OAAO,CAACc,OAAR,CAAgB,aAAhB,CAAd,CAAN;AACA,QAAMR,IAAI,CAACK,WAAL,CAAiBU,OAAO,CAACC,GAAR,CAAY,CAAEf,MAAM,CAACU,MAAP,CAAcC,MAAd,CAAqB,IAArB,CAAF,EAA8BX,MAAM,CAACG,GAAP,EAA9B,CAAZ,CAAjB,EAA4E,EAAE,cAAcb,yBAAhB,EAA5E,CAAN;;AAED,CAPD;;AASAJ,IAAI,CAACY,IAAL,CAAU,6EAAV,EAAyF,MAAOC,IAAP,IAAgB;;AAEvG,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,MAAI;;AAEF,UAAMY,MAAM,CAACL,MAAP,CAAcF,OAAO,CAACc,OAAR,CAAgB,aAAhB,CAAd,CAAN;;AAEA,QAAIS,eAAe,GAAG,IAAtB;AACAA,IAAAA,eAAe,GAAGhB,MAAM,CAACgB,eAAzB;;AAEAhB,IAAAA,MAAM,CAACgB,eAAP,GAAyB,IAAzB;AACA,UAAMjB,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACU,MAAP,CAAcC,MAAd,CAAqB,IAArB,CAAjB,EAA6C,EAAE,cAActB,iCAAhB,EAA7C,CAAN;AACAW,IAAAA,MAAM,CAACgB,eAAP,GAAyBA,eAAzB;;AAED,GAXD,SAWU;AACR,UAAMhB,MAAM,CAACG,GAAP,EAAN;AACD;;AAEF,CAnBD;;AAqBAjB,IAAI,CAACY,IAAL,CAAU,sEAAV,EAAkF,MAAOC,IAAP,IAAgB;;AAEhG,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,QAAMY,MAAM,CAACE,IAAP,EAAN,CAJgG,CAI5E;;AAEpB,MAAIc,eAAe,GAAG,IAAtB;AACAA,EAAAA,eAAe,GAAGhB,MAAM,CAACgB,eAAzB;;AAEAhB,EAAAA,MAAM,CAACgB,eAAP,GAAyB,CAAzB;AACA,QAAMjB,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACG,GAAP,EAAjB,EAA+B,EAAE,cAAcd,iCAAhB,EAA/B,CAAN;AACAW,EAAAA,MAAM,CAACgB,eAAP,GAAyBA,eAAzB;;AAED,CAbD;;AAeA9B,IAAI,CAACY,IAAL,CAAU,2BAAV,EAAuC,MAAOC,IAAP,IAAgB;;AAErD,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,QAAMW,IAAI,CAACE,cAAL,CAAoBD,MAAM,CAACE,IAAP,EAApB,CAAN,CAJqD,CAIZ;AACzC,QAAMF,MAAM,CAACiB,UAAP,EAAN;AACA,QAAMlB,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACE,IAAP,EAAjB,EAAgC,EAAE,QAAQ,wBAAV,EAAhC,CAAN;;AAED,CARD;;AAUAhB,IAAI,CAACY,IAAL,CAAU,oBAAV,EAAgC,MAAOC,IAAP,IAAgB;;AAE9C,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb,CAF8C,CAEd;;AAEhC;AACA,QAAMY,MAAM,CAACL,MAAP,CAAcF,OAAO,CAACc,OAAR,CAAgB,aAAhB,CAAd,CAAN;;AAEA,QAAMP,MAAM,CAACG,GAAP,CAAW,EAAE,OAAOH,MAAM,CAACM,GAAhB,EAAX,CAAN,CAP8C,CAON;AACxC,QAAMP,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACE,IAAP,EAAjB,EAAgC,EAAE,QAAQ,wBAAV,EAAhC,CAAN;;AAED,CAVD;;AAYAhB,IAAI,CAACY,IAAL,CAAU,qBAAV,EAAiC,MAAOC,IAAP,IAAgB;;AAE/C,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,QAAMW,IAAI,CAACE,cAAL,CAAoBD,MAAM,CAACE,IAAP,EAApB,CAAN,CAJ+C,CAIN;AACzC,QAAMF,MAAM,CAACK,IAAP,EAAN;AACA,QAAMN,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACE,IAAP,EAAjB,EAAgC,EAAE,QAAQ,wBAAV,EAAhC,CAAN;;AAED,CARD;;AAUAhB,IAAI,CAACY,IAAL,CAAU,kCAAV,EAA8C,MAAOC,IAAP,IAAgB;;AAE5D,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,QAAMY,MAAM,CAACkB,iBAAP,EAAN,CAJ4D,CAI3B;AACjC,QAAMnB,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACE,IAAP,EAAjB,EAAgC,EAAE,QAAQ,wBAAV,EAAhC,CAAN;;AAED,CAPD;;AASAhB,IAAI,CAACY,IAAL,CAAU,mCAAV,EAA+C,MAAOC,IAAP,IAAgB;;AAE7D;AACA;;AAEA,MAAIC,MAAM,GAAG,IAAIZ,YAAJ,EAAb;;AAEA,QAAMY,MAAM,CAACmB,kBAAP,EAAN,CAP6D,CAO3B;AAClC,QAAMpB,IAAI,CAACK,WAAL,CAAiBJ,MAAM,CAACE,IAAP,EAAjB,EAAgC,EAAE,QAAQ,wBAAV,EAAhC,CAAN;;AAED,CAVD","sourcesContent":["import Test from 'ava'\n\nimport { LoggedClient } from './logged-client.js'\nimport { WorkerClient } from '../../index.js'\n\nimport { WorkerClientDurationExceededError } from '../../index.js'\nimport { WorkerClientRejectedError } from '../../library/error/worker-client-rejected-error.js'\n\nconst Process = process\nconst Require = __require\n\nTest.skip('new WorkerClient()', async (test) => {\n\n  let worker = new LoggedClient()\n\n  try {\n    await test.notThrowsAsync(worker.ping())\n  } finally {\n    await worker.end()\n  }\n\n})\n\nTest.skip('WorkerClient.ping() throws WorkerClientDurationExceededError', async (test) => {\n\n  let worker = new WorkerClient({ 'maximumDuration': 1 })\n\n  try {\n    await test.throwsAsync(worker.ping(), { 'instanceOf': WorkerClientDurationExceededError })\n  } finally {\n    // we can't use worker.kill() because it'll timeout\n    Process.kill(worker.pid)\n  }\n\n})\n\nTest.skip('WorkerClient.import(url)', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n   \n    let pid = await worker.import(Require.resolve('./worker.js'))\n    test.is(pid, worker.pid)\n\n    await test.throwsAsync(worker.import(Require.resolve('./worker.js')), { 'instanceOf': Error })\n    test.is(await worker.module.getPid(), worker.pid)\n\n  } finally {\n    await worker.end()\n  }\n\n})\n\nTest.skip('WorkerClient.import(url) throws Error', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n\n    await worker.import(Require.resolve('./worker.js'))\n\n    await test.throwsAsync(worker.module._getPid(), { 'instanceOf': Error })\n\n  } finally {\n    await worker.end()\n  }\n\n})\n\nTest.skip('WorkerClient.release()', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n\n    let pid = null\n    pid = await worker.import(Require.resolve('./worker.js'))\n    pid = await worker.release()\n\n    test.is(pid, worker.pid)\n    test.is(worker.module, null)\n\n  } finally {\n    await worker.end()\n  }\n\n})\n\nTest.skip('WorkerClient.release() throws Error', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n\n    await worker.import(Require.resolve('./worker.js'))\n    await worker.release()\n\n    await test.throwsAsync(worker.release(), { 'instanceOf': Error })\n\n  } finally {\n    await worker.end()\n  }\n\n})\n\nTest.skip('WorkerClient.getPid(duration) throws WorkerClientRejectedError', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await worker.import(Require.resolve('./worker.js'))\n  await test.throwsAsync(Promise.all([ worker.module.getPid(2500), worker.end() ]), { 'instanceOf': WorkerClientRejectedError })\n\n})\n\nTest.skip('WorkerClient.whenMessageType(type) throws WorkerClientDurationExceededError', async (test) => {\n\n  let worker = new WorkerClient()\n\n  try {\n\n    await worker.import(Require.resolve('./worker.js'))\n\n    let maximumDuration = null\n    maximumDuration = worker.maximumDuration\n\n    worker.maximumDuration = 2000\n    await test.throwsAsync(worker.module.getPid(2500), { 'instanceOf': WorkerClientDurationExceededError })\n    worker.maximumDuration = maximumDuration\n\n  } finally {\n    await worker.end()\n  }\n\n})\n\nTest.skip('WorkerClient.whenRejected() throws WorkerClientDurationExceededError', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await worker.ping() // establish is ready before call to end\n\n  let maximumDuration = null\n  maximumDuration = worker.maximumDuration\n\n  worker.maximumDuration = 1\n  await test.throwsAsync(worker.end(), { 'instanceOf': WorkerClientDurationExceededError })\n  worker.maximumDuration = maximumDuration\n\n})\n\nTest.skip('WorkerClient.disconnect()', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await test.notThrowsAsync(worker.ping()) // establishes is ready\n  await worker.disconnect()\n  await test.throwsAsync(worker.ping(), { 'code': 'ERR_IPC_CHANNEL_CLOSED' })\n\n})\n\nTest.skip('WorkerClient.end()', async (test) => {\n\n  let worker = new WorkerClient() // LoggedClient() // \n\n  // this import is required because it contains the onEnd method\n  await worker.import(Require.resolve('./worker.js'))\n\n  await worker.end({ 'pid': worker.pid }) // also establishes is ready\n  await test.throwsAsync(worker.ping(), { 'code': 'ERR_IPC_CHANNEL_CLOSED' })\n\n})\n\nTest.skip('WorkerClient.kill()', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await test.notThrowsAsync(worker.ping()) // establishes is ready\n  await worker.kill()\n  await test.throwsAsync(worker.ping(), { 'code': 'ERR_IPC_CHANNEL_CLOSED' })\n\n})\n\nTest.skip('WorkerClient.uncaughtException()', async (test) => {\n\n  let worker = new WorkerClient()\n\n  await worker.uncaughtException() // also establishes is ready\n  await test.throwsAsync(worker.ping(), { 'code': 'ERR_IPC_CHANNEL_CLOSED' })\n\n})\n \nTest.skip('WorkerClient.unhandledRejection()', async (test) => {\n\n  // this test requires that unhandled promises exit the node process\n  // this is enabled by the --unhandled-rejections=strict argument\n\n  let worker = new WorkerClient()\n\n  await worker.unhandledRejection() // also establishes is ready\n  await test.throwsAsync(worker.ping(), { 'code': 'ERR_IPC_CHANNEL_CLOSED' })\n\n})\n"],"file":"worker-client.test.js"}