{"version":3,"sources":["../../../source/test/library/worker-pool.test.js"],"names":["Sinon","Test","LoggedPool","WorkerPool","WorkerClientDurationExceededError","WorkerPoolDisconnectedError","WorkerClientRejectedError","Process","process","Require","_createRequire","import","meta","url","test","pool","notThrows","notThrowsAsync","end","longMaximumDuration","is","maximumDuration","shortMaximumDuration","module","moduleUrl","resolve","not","release","sandbox","createSandbox","spy","getPid","true","_selectProcessInformation","calledOnce","restore","ping","throwsAsync","throws","only","throwUncaughtException","Promise","setTimeout","skip","rejectUnhandledException","uncaughtException","unhandledRejection","_getConnectedProcessInformation","length","forEach","worker","kill","pid","allPid","onePid","assert","includes","Error","_getPid","all","disconnect"],"mappings":"yDAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,IAAP,MAAiB,KAAjB;;AAEA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,UAAT,QAA2B,gBAA3B;;AAEA,SAASC,iCAAT,EAA4CC,2BAA5C,QAA+E,gBAA/E;AACA,SAASC,yBAAT,QAA0C,qDAA1C;;AAEA,MAAMC,OAAO,GAAGC,OAAhB;AACA,MAAMC,OAAO,GAVbC,cAAc,CAACC,MAAM,CAACC,IAAP,CAAYC,GAAb,CAUd;;AAEAZ,IAAI,CAAC,kBAAD,EAAqB,MAAOa,IAAP,IAAgB;;AAEvC,MAAIC,IAAI,GAAG,IAAX;;AAEAD,EAAAA,IAAI,CAACE,SAAL,CAAe,MAAM,CAAED,IAAI,GAAG,IAAIZ,UAAJ,EAAP,CAAwB,CAA/C;AACA,QAAMW,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACG,GAAL,EAApB,CAAN;;AAED,CAPG,CAAJ;;AASAjB,IAAI,CAAC,4CAAD,EAA+C,MAAOa,IAAP,IAAgB;;AAEjE,MAAIK,mBAAmB,GAAG,IAA1B;AACA,MAAIJ,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmBgB,mBAArB,EAAf,CAAX;;AAEA,MAAI;AACFL,IAAAA,IAAI,CAACM,EAAL,CAAQL,IAAI,CAACM,eAAb,EAA8BF,mBAA9B;AACD,GAFD,SAEU;AACR,UAAMJ,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAXG,CAAJ;;AAaAjB,IAAI,CAAC,4BAAD,EAA+B,MAAOa,IAAP,IAAgB;;AAEjD,MAAIQ,oBAAoB,GAAG,IAA3B;AACA,MAAIH,mBAAmB,GAAG,IAA1B;;AAEA,MAAIJ,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,MAAI;;AAEFY,IAAAA,IAAI,CAACM,eAAL,GAAuBC,oBAAvB;AACAR,IAAAA,IAAI,CAACM,EAAL,CAAQL,IAAI,CAACM,eAAb,EAA8BC,oBAA9B;AACAP,IAAAA,IAAI,CAACM,eAAL,GAAuBF,mBAAvB;;AAED,GAND,SAMU;AACR,UAAMJ,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAjBG,CAAJ;;AAmBAjB,IAAI,CAAC,uBAAD,EAA0B,MAAOa,IAAP,IAAgB;;AAE5C,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,MAAI;;AAEF;AACAW,IAAAA,IAAI,CAACM,EAAL,CAAQL,IAAI,CAACQ,MAAb,EAAqB,IAArB;AACAT,IAAAA,IAAI,CAACM,EAAL,CAAQL,IAAI,CAACS,SAAb,EAAwB,IAAxB;;AAEA,UAAMT,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAN;;AAEA;AACAX,IAAAA,IAAI,CAACY,GAAL,CAASX,IAAI,CAACQ,MAAd,EAAsB,IAAtB;AACAT,IAAAA,IAAI,CAACY,GAAL,CAASX,IAAI,CAACS,SAAd,EAAyB,IAAzB;;AAEA,UAAMT,IAAI,CAACY,OAAL,EAAN;;AAEA;AACAb,IAAAA,IAAI,CAACM,EAAL,CAAQL,IAAI,CAACQ,MAAb,EAAqB,IAArB;AACAT,IAAAA,IAAI,CAACM,EAAL,CAAQL,IAAI,CAACS,SAAb,EAAwB,IAAxB;;AAED,GAlBD,SAkBU;AACR,UAAMT,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CA1BG,CAAJ;;AA4BAjB,IAAI,CAAC,6DAAD,EAAgE,MAAOa,IAAP,IAAgB;;AAElF,QAAMc,OAAO,GAAG5B,KAAK,CAAC6B,aAAN,EAAhB;;AAEA,MAAI;;AAEF,QAAId,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,QAAI;;AAEFyB,MAAAA,OAAO,CAACE,GAAR,CAAYf,IAAZ,EAAkB,2BAAlB;;AAEA,YAAMA,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAN;AACA,YAAMV,IAAI,CAACQ,MAAL,CAAYQ,MAAZ,EAAN;;AAEAjB,MAAAA,IAAI,CAACkB,IAAL,CAAUjB,IAAI,CAACkB,yBAAL,CAA+BC,UAAzC;;AAED,KATD,SASU;AACR,YAAMnB,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,GAjBD,SAiBU;AACRU,IAAAA,OAAO,CAACO,OAAR;AACD;;AAEF,CAzBG,CAAJ;;AA2BAlC,IAAI,CAAC,mBAAD,EAAsB,MAAOa,IAAP,IAAgB;;AAExC,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,MAAI;AACF;AACA,UAAMW,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACqB,IAAL,EAApB,CAAN;AACD,GAHD,SAGU;AACR,UAAMrB,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAXG,CAAJ;;AAaAjB,IAAI,CAAC,sDAAD,EAAyD,MAAOa,IAAP,IAAgB;;AAE3E,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,QAAMY,IAAI,CAACG,GAAL,EAAN;AACA,QAAMJ,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACqB,IAAL,EAAjB,EAA8B,EAAE,cAAc/B,2BAAhB,EAA9B,CAAN;;AAED,CAPG,CAAJ;;AASAJ,IAAI,CAAC,gCAAD,EAAmC,MAAOa,IAAP,IAAgB;;AAErD,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,MAAI;AACF,UAAMW,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAApB,CAAN;AACD,GAFD,SAEU;AACR,UAAMV,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAVG,CAAJ;;AAYAjB,IAAI,CAAC,mEAAD,EAAsE,MAAOa,IAAP,IAAgB;;AAExF,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,QAAMY,IAAI,CAACG,GAAL,EAAN;AACA,QAAMJ,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAjB,EAA8D,EAAE,cAAcpB,2BAAhB,EAA9D,CAAN;;AAED,CAPG,CAAJ;;AASAJ,IAAI,CAAC,4BAAD,EAA+B,MAAOa,IAAP,IAAgB;;AAEjD,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,MAAI;AACF,UAAMY,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAN;AACA,UAAMX,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACY,OAAL,EAApB,CAAN;AACD,GAHD,SAGU;AACR,UAAMZ,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAXG,CAAJ;;AAaAjB,IAAI,CAAC,+DAAD,EAAkE,MAAOa,IAAP,IAAgB;;AAEpF,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,QAAMY,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAN;AACA,QAAMV,IAAI,CAACG,GAAL,EAAN;AACA,QAAMJ,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACY,OAAL,EAAjB,EAAiC,EAAE,cAActB,2BAAhB,EAAjC,CAAN;;AAED,CARG,CAAJ;;AAUAJ,IAAI,CAAC,wBAAD,EAA2B,MAAOa,IAAP,IAAgB;AAC7C,QAAMA,IAAI,CAACG,cAAL,CAAqB,IAAId,UAAJ,EAAD,CAAmBe,GAAnB,EAApB,CAAN;AACD,CAFG,CAAJ;;AAIAjB,IAAI,CAAC,2DAAD,EAA8D,MAAOa,IAAP,IAAgB;;AAEhF,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,QAAMY,IAAI,CAACG,GAAL,EAAN;AACA,QAAMJ,IAAI,CAACwB,MAAL,CAAY,MAAM,CAAEvB,IAAI,CAACG,GAAL,GAAY,CAAhC,EAAkC,EAAE,cAAcb,2BAAhB,EAAlC,CAAN;;AAED,CAPG,CAAJ;;AASAJ,IAAI,CAACsC,IAAL,CAAU,4CAAV,EAAwD,MAAOzB,IAAP,IAAgB;;AAEtE,MAAIC,IAAI,GAAG,IAAIb,UAAJ,CAAeO,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAf,EAA+C,EAAE,mBAAmB,CAArB,EAA/C,CAAX;;AAEA,MAAI;AACF,UAAMX,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACQ,MAAL,CAAYiB,sBAAZ,EAApB,CAAN,CADE,CAC8D;AAChE,UAAM,IAAIC,OAAJ,CAAahB,OAAD,IAAaiB,UAAU,CAACjB,OAAD,EAAU,IAAV,CAAnC,CAAN;AACD,GAHD,SAGU;AACR,UAAMV,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAXD;;AAaAjB,IAAI,CAAC0C,IAAL,CAAU,8CAAV,EAA0D,MAAO7B,IAAP,IAAgB;;AAExE,MAAIC,IAAI,GAAG,IAAIb,UAAJ,CAAeO,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAf,EAA+C,EAAE,mBAAmB,CAArB,EAA/C,CAAX;;AAEA,MAAI;AACF,UAAMX,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACQ,MAAL,CAAYqB,wBAAZ,EAApB,CAAN,CADE,CACgE;AAClE,UAAM,IAAIH,OAAJ,CAAahB,OAAD,IAAaiB,UAAU,CAACjB,OAAD,EAAU,IAAV,CAAnC,CAAN;AACD,GAHD,SAGU;AACR,UAAMV,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAXD;;AAaAjB,IAAI,CAAC0C,IAAL,CAAU,gCAAV,EAA4C,MAAO7B,IAAP,IAAgB;;AAE1D,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,EAAX;;AAEA,MAAI;;AAEF,UAAMY,IAAI,CAAC8B,iBAAL,EAAN;AACA,UAAM/B,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACqB,IAAL,EAApB,CAAN,CAHE,CAGqC;;AAExC,GALD,SAKU;AACR,UAAMrB,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAbD;;AAeAjB,IAAI,CAAC0C,IAAL,CAAU,iCAAV,EAA6C,MAAO7B,IAAP,IAAgB;;AAE3D;AACA;;AAEA,MAAIC,IAAI,GAAG,IAAIb,UAAJ,EAAX;;AAEA,MAAI;;AAEF,UAAMa,IAAI,CAAC+B,kBAAL,EAAN;AACA,UAAMhC,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACqB,IAAL,EAApB,CAAN,CAHE,CAGqC;;AAExC,GALD,SAKU;AACR,UAAMrB,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAhBD;;AAkBAjB,IAAI,CAAC0C,IAAL,CAAU,4CAAV,EAAwD,MAAO7B,IAAP,IAAgB;;AAEtE,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA,MAAI;AACFW,IAAAA,IAAI,CAACM,EAAL,CAAQL,IAAI,CAACgC,+BAAL,GAAuCC,MAA/C,EAAuD,CAAvD;AACD,GAFD,SAEU;AACR,UAAMjC,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAVD;;AAYAjB,IAAI,CAAC0C,IAAL,CAAU,2EAAV,EAAuF,MAAO7B,IAAP,IAAgB;;AAErG,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA,MAAI;;AAEF,UAAMY,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAN;;AAEA,QAAIJ,eAAe,GAAG,IAAtB;AACAA,IAAAA,eAAe,GAAGN,IAAI,CAACM,eAAvB;;AAEAN,IAAAA,IAAI,CAACM,eAAL,GAAuB,IAAvB;AACA,UAAMP,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACQ,MAAL,CAAYQ,MAAZ,CAAmB,IAAnB,CAAjB,EAA2C,EAAE,cAAc3B,iCAAhB,EAA3C,CAAN;AACAW,IAAAA,IAAI,CAACM,eAAL,GAAuBA,eAAvB;;AAED,GAXD,SAWU;AACR,UAAMN,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAnBD;;AAqBAjB,IAAI,CAAC0C,IAAL,CAAU,4DAAV,EAAwE,MAAO7B,IAAP,IAAgB;;AAEtF,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAwB,mBAAmB,CAA3C,EAAf,CAAX;;AAEA,MAAI;AACF,UAAMW,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACqB,IAAL,EAAjB,EAA8B,EAAE,cAAchC,iCAAhB,EAA9B,CAAN;AACD,GAFD,SAEU;AACR;AACAW,IAAAA,IAAI,CAACgC,+BAAL,GAAuCE,OAAvC,CAA+C,CAAC,EAAEzC,OAAO,EAAE0C,MAAX,EAAD,KAAyB3C,OAAO,CAAC4C,IAAR,CAAaD,MAAM,CAACE,GAApB,CAAxE;AACD;;AAEF,CAXD;;AAaAnD,IAAI,CAAC0C,IAAL,CAAU,wBAAV,EAAoC,MAAO7B,IAAP,IAAgB;;AAElD,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA,MAAI;;AAEF,QAAIkD,MAAM,GAAG,MAAMtC,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAnB;AACA,QAAI6B,MAAM,GAAG,MAAMvC,IAAI,CAACQ,MAAL,CAAYQ,MAAZ,EAAnB;;AAEAjB,IAAAA,IAAI,CAACyC,MAAL,CAAYF,MAAM,CAACG,QAAP,CAAgBF,MAAhB,CAAZ;AACA,UAAMxC,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAjB,EAA8D,EAAE,cAAcgC,KAAhB,EAA9D,CAAN;;AAED,GARD,SAQU;AACR,UAAM1C,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAhBD;;AAkBAjB,IAAI,CAAC0C,IAAL,CAAU,qCAAV,EAAiD,MAAO7B,IAAP,IAAgB;;AAE/D,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA,MAAI;;AAEF,UAAMY,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAN;;AAEA,UAAMX,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACQ,MAAL,CAAYmC,OAAZ,EAAjB,EAAwC,EAAE,cAAcD,KAAhB,EAAxC,CAAN;;AAED,GAND,SAMU;AACR,UAAM1C,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAdD;;AAgBAjB,IAAI,CAAC0C,IAAL,CAAU,sBAAV,EAAkC,MAAO7B,IAAP,IAAgB;;AAEhD,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA,MAAI;;AAEF,QAAIkD,MAAM,GAAG,MAAMtC,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAnB;AACA,QAAI6B,MAAM,GAAG,MAAMvC,IAAI,CAACQ,MAAL,CAAYQ,MAAZ,EAAnB;;AAEAsB,IAAAA,MAAM,GAAG,MAAMtC,IAAI,CAACY,OAAL,EAAf;;AAEAb,IAAAA,IAAI,CAACyC,MAAL,CAAYF,MAAM,CAACG,QAAP,CAAgBF,MAAhB,CAAZ;AACAxC,IAAAA,IAAI,CAACM,EAAL,CAAQL,IAAI,CAACQ,MAAb,EAAqB,IAArB;;AAED,GAVD,SAUU;AACR,UAAMR,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAlBD;;AAoBAjB,IAAI,CAAC0C,IAAL,CAAU,mCAAV,EAA+C,MAAO7B,IAAP,IAAgB;;AAE7D,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA,MAAI;;AAEF,UAAMY,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAN;AACA,UAAMV,IAAI,CAACY,OAAL,EAAN;;AAEA,UAAMb,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACY,OAAL,EAAjB,EAAiC,EAAE,cAAc8B,KAAhB,EAAjC,CAAN;;AAED,GAPD,SAOU;AACR,UAAM1C,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAfD;;AAiBAjB,IAAI,CAAC0C,IAAL,CAAU,8DAAV,EAA0E,MAAO7B,IAAP,IAAgB;;AAExF,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA,QAAMY,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAN;AACA,QAAMX,IAAI,CAACuB,WAAL,CAAiBI,OAAO,CAACkB,GAAR,CAAY,CAAE5C,IAAI,CAACQ,MAAL,CAAYQ,MAAZ,CAAmB,IAAnB,CAAF,EAA4BhB,IAAI,CAACG,GAAL,EAA5B,CAAZ,CAAjB,EAAwE,EAAE,cAAcZ,yBAAhB,EAAxE,CAAN;;AAED,CAPD;;AASAL,IAAI,CAAC0C,IAAL,CAAU,oEAAV,EAAgF,MAAO7B,IAAP,IAAgB;;AAE9F,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA,QAAMY,IAAI,CAACqB,IAAL,EAAN,CAJ8F,CAI5E;;AAElB,MAAIf,eAAe,GAAG,IAAtB;AACAA,EAAAA,eAAe,GAAGN,IAAI,CAACM,eAAvB;;AAEAN,EAAAA,IAAI,CAACM,eAAL,GAAuB,CAAvB;AACA,QAAMP,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACG,GAAL,EAAjB,EAA6B,EAAE,cAAcd,iCAAhB,EAA7B,CAAN;AACAW,EAAAA,IAAI,CAACM,eAAL,GAAuBA,eAAvB;;AAED,CAbD;;AAeApB,IAAI,CAAC0C,IAAL,CAAU,yBAAV,EAAqC,MAAO7B,IAAP,IAAgB;;AAEnD,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA,QAAMW,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACqB,IAAL,EAApB,CAAN,CAJmD,CAIZ;AACvC,QAAMrB,IAAI,CAAC6C,UAAL,EAAN;AACA,QAAM9C,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACqB,IAAL,EAAjB,EAA8B,EAAE,cAAc/B,2BAAhB,EAA9B,CAAN;;AAED,CARD;;AAUAJ,IAAI,CAAC0C,IAAL,CAAU,kBAAV,EAA8B,MAAO7B,IAAP,IAAgB;;AAE5C,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA;AACA,QAAMY,IAAI,CAACJ,MAAL,CAAYF,OAAO,CAACgB,OAAR,CAAgB,aAAhB,CAAZ,CAAN;;AAEA,QAAMV,IAAI,CAACG,GAAL,CAAS,EAAE,OAAO,KAAT,EAAT,CAAN,CAP4C,CAOX;AACjC,QAAMJ,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACqB,IAAL,EAAjB,CAAN,CAR4C,CAQR;;AAErC,CAVD;;AAYAnC,IAAI,CAAC0C,IAAL,CAAU,mBAAV,EAA+B,MAAO7B,IAAP,IAAgB;;AAE7C,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,mBAAmB,CAArB,EAAf,CAAX;;AAEA,MAAI;;AAEF,UAAMW,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACqB,IAAL,EAApB,CAAN,CAFE,CAEqC;AACvC,UAAMrB,IAAI,CAACoC,IAAL,EAAN;AACA,UAAMrC,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACqB,IAAL,EAApB,CAAN,CAJE,CAIqC;;AAExC,GAND,SAMU;AACR,UAAMrB,IAAI,CAACG,GAAL,EAAN;AACD;;AAEF,CAdD;;AAgBAjB,IAAI,CAAC0C,IAAL,CAAU,mDAAV,EAA+D,MAAO7B,IAAP,IAAgB;;AAE7E,MAAIC,IAAI,GAAG,IAAIZ,UAAJ,CAAe,EAAE,yBAAyB,CAA3B,EAA8B,mBAAmB,CAAjD,EAAf,CAAX;;AAEA,QAAMW,IAAI,CAACG,cAAL,CAAoBF,IAAI,CAACqB,IAAL,EAApB,CAAN,CAJ6E,CAItC;AACvC,QAAMrB,IAAI,CAACoC,IAAL,EAAN;AACA,QAAMrC,IAAI,CAACuB,WAAL,CAAiBtB,IAAI,CAACqB,IAAL,EAAjB,CAAN,CAN6E,CAMzC;;AAErC,CARD","sourcesContent":["import Sinon from 'sinon'\nimport Test from 'ava'\n\nimport { LoggedPool } from './logged-pool.js'\nimport { WorkerPool } from '../../index.js'\n\nimport { WorkerClientDurationExceededError, WorkerPoolDisconnectedError } from '../../index.js'\nimport { WorkerClientRejectedError } from '../../library/error/worker-client-rejected-error.js'\n\nconst Process = process\nconst Require = __require\n\nTest('new WorkerPool()', async (test) => {\n\n  let pool = null\n  \n  test.notThrows(() => { pool = new WorkerPool()})\n  await test.notThrowsAsync(pool.end())\n\n})\n\nTest('new WorkerPool({ \\'maximumDuration\\': N })', async (test) => {\n\n  let longMaximumDuration = 5000\n  let pool = new WorkerPool({ 'maximumDuration': longMaximumDuration})\n\n  try {\n    test.is(pool.maximumDuration, longMaximumDuration)\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest('WorkerPool.maximumDuration', async (test) => {\n\n  let shortMaximumDuration = 1000\n  let longMaximumDuration = 5000\n\n  let pool = new WorkerPool()\n\n  try {\n\n    pool.maximumDuration = shortMaximumDuration\n    test.is(pool.maximumDuration, shortMaximumDuration)\n    pool.maximumDuration = longMaximumDuration\n\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest('WorkerPool.module/Url', async (test) => {\n\n  let pool = new WorkerPool()\n\n  try {\n\n    // before import\n    test.is(pool.module, null)\n    test.is(pool.moduleUrl, null)\n\n    await pool.import(Require.resolve('./worker.js'))\n\n    // after import\n    test.not(pool.module, null)\n    test.not(pool.moduleUrl, null)\n\n    await pool.release()\n\n    // after release\n    test.is(pool.module, null)\n    test.is(pool.moduleUrl, null)\n\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest('WorkerPool._selectProcessInformation(methodName, parameter)', async (test) => {\n\n  const sandbox = Sinon.createSandbox()\n\n  try {\n\n    let pool = new WorkerPool()\n\n    try {\n  \n      sandbox.spy(pool, '_selectProcessInformation')\n  \n      await pool.import(Require.resolve('./worker.js'))\n      await pool.module.getPid()\n\n      test.true(pool._selectProcessInformation.calledOnce)\n  \n    } finally {\n      await pool.end()\n    }\n  \n  } finally {\n    sandbox.restore()\n  }\n\n})\n\nTest('WorkerPool.ping()', async (test) => {\n\n  let pool = new WorkerPool()\n\n  try {\n    // does not show the code as executed :-(\n    await test.notThrowsAsync(pool.ping())\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest('WorkerPool.ping() throws WorkerPoolDisconnectedError', async (test) => {\n\n  let pool = new WorkerPool()\n\n  await pool.end()\n  await test.throwsAsync(pool.ping(), { 'instanceOf': WorkerPoolDisconnectedError })\n\n})\n\nTest('WorkerPool.import(url, option)', async (test) => {\n\n  let pool = new WorkerPool()\n\n  try {\n    await test.notThrowsAsync(pool.import(Require.resolve('./worker.js')))\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest('WorkerPool.import(url, option) throws WorkerPoolDisconnectedError', async (test) => {\n\n  let pool = new WorkerPool()\n\n  await pool.end()\n  await test.throwsAsync(pool.import(Require.resolve('./worker.js')), { 'instanceOf': WorkerPoolDisconnectedError })\n\n})\n\nTest('WorkerPool.release(option)', async (test) => {\n\n  let pool = new WorkerPool()\n\n  try {\n    await pool.import(Require.resolve('./worker.js'))\n    await test.notThrowsAsync(pool.release())\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest('WorkerPool.release(option) throws WorkerPoolDisconnectedError', async (test) => {\n\n  let pool = new WorkerPool()\n\n  await pool.import(Require.resolve('./worker.js'))\n  await pool.end()\n  await test.throwsAsync(pool.release(), { 'instanceOf': WorkerPoolDisconnectedError })\n\n})\n\nTest('WorkerPool.end(option)', async (test) => {\n  await test.notThrowsAsync((new WorkerPool()).end())\n})\n\nTest('WorkerPool.end(option) throws WorkerPoolDisconnectedError', async (test) => {\n\n  let pool = new WorkerPool()\n\n  await pool.end()\n  await test.throws(() => { pool.end() }, { 'instanceOf': WorkerPoolDisconnectedError })\n\n})\n\nTest.only('WorkerPool.module.throwUncaughtException()', async (test) => {\n\n  let pool = new LoggedPool(Require.resolve('./worker.js'), { 'numberOfProcess': 1 })\n\n  try {\n    await test.notThrowsAsync(pool.module.throwUncaughtException()) // the pool should recreate exited processes\n    await new Promise((resolve) => setTimeout(resolve, 3000))\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest.skip('WorkerPool.module.rejectUnhandledException()', async (test) => {\n\n  let pool = new LoggedPool(Require.resolve('./worker.js'), { 'numberOfProcess': 1 })\n\n  try {\n    await test.notThrowsAsync(pool.module.rejectUnhandledException()) // the pool should recreate exited processes\n    await new Promise((resolve) => setTimeout(resolve, 3000))\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest.skip('WorkerPool.uncaughtException()', async (test) => {\n\n  let pool = new WorkerPool()\n\n  try {\n\n    await pool.uncaughtException()\n    await test.notThrowsAsync(pool.ping()) // the pool should recreate exited processes\n  \n  } finally {\n    await pool.end()\n  }\n\n})\n \nTest.skip('WorkerPool.unhandledRejection()', async (test) => {\n\n  // this test requires that unhandled promises exit the node process\n  // this is enabled by the --unhandled-rejections=strict argument\n\n  let pool = new LoggedPool()\n\n  try {\n\n    await pool.unhandledRejection()\n    await test.notThrowsAsync(pool.ping()) // the pool should recreate exited processes\n  \n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest.skip('new WorkerPool({ \\'numberOfProcess\\': 2 })', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  try {\n    test.is(pool._getConnectedProcessInformation().length, 2)\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest.skip('WorkerPool.whenMessageType(type) throws WorkerClientDurationExceededError', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  try {\n\n    await pool.import(Require.resolve('./worker.js'))\n\n    let maximumDuration = null\n    maximumDuration = pool.maximumDuration\n\n    pool.maximumDuration = 2000\n    await test.throwsAsync(pool.module.getPid(2500), { 'instanceOf': WorkerClientDurationExceededError })\n    pool.maximumDuration = maximumDuration\n\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest.skip('WorkerPool.ping() throws WorkerClientDurationExceededError', async (test) => {\n\n  let pool = new WorkerPool({ 'maximumDuration': 1, 'numberOfProcess': 2 })\n\n  try {\n    await test.throwsAsync(pool.ping(), { 'instanceOf': WorkerClientDurationExceededError })\n  } finally {\n    // we can't use pool.kill() because it'll timeout\n    pool._getConnectedProcessInformation().forEach(({ process: worker }) => Process.kill(worker.pid)) \n  }\n\n})\n\nTest.skip('WorkerPool.import(url)', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  try {\n   \n    let allPid = await pool.import(Require.resolve('./worker.js'))\n    let onePid = await pool.module.getPid()\n\n    test.assert(allPid.includes(onePid))\n    await test.throwsAsync(pool.import(Require.resolve('./worker.js')), { 'instanceOf': Error })\n\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest.skip('WorkerPool.import(url) throws Error', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  try {\n\n    await pool.import(Require.resolve('./worker.js'))\n\n    await test.throwsAsync(pool.module._getPid(), { 'instanceOf': Error })\n\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest.skip('WorkerPool.release()', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  try {\n\n    let allPid = await pool.import(Require.resolve('./worker.js'))\n    let onePid = await pool.module.getPid()\n\n    allPid = await pool.release()\n\n    test.assert(allPid.includes(onePid))\n    test.is(pool.module, null)\n\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest.skip('WorkerPool.release() throws Error', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  try {\n\n    await pool.import(Require.resolve('./worker.js'))\n    await pool.release()\n\n    await test.throwsAsync(pool.release(), { 'instanceOf': Error })\n\n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest.skip('WorkerPool.getPid(duration) throws WorkerClientRejectedError', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  await pool.import(Require.resolve('./worker.js'))\n  await test.throwsAsync(Promise.all([ pool.module.getPid(2500), pool.end() ]), { 'instanceOf': WorkerClientRejectedError })\n\n})\n\nTest.skip('WorkerPool.whenRejected() throws WorkerClientDurationExceededError', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  await pool.ping() // establish is ready before call to end\n\n  let maximumDuration = null\n  maximumDuration = pool.maximumDuration\n\n  pool.maximumDuration = 1\n  await test.throwsAsync(pool.end(), { 'instanceOf': WorkerClientDurationExceededError })\n  pool.maximumDuration = maximumDuration\n\n})\n\nTest.skip('WorkerPool.disconnect()', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  await test.notThrowsAsync(pool.ping()) // establishes is ready\n  await pool.disconnect()\n  await test.throwsAsync(pool.ping(), { 'instanceOf': WorkerPoolDisconnectedError })\n\n})\n\nTest.skip('WorkerPool.end()', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  // this import is required because it contains the onEnd method\n  await pool.import(Require.resolve('./worker.js'))\n\n  await pool.end({ 'pid': 10000 }) // also establishes is ready\n  await test.throwsAsync(pool.ping()) // , { 'instanceOf': WorkerPoolDisconnectedError })\n\n})\n\nTest.skip('WorkerPool.kill()', async (test) => {\n\n  let pool = new WorkerPool({ 'numberOfProcess': 2 })\n\n  try {\n\n    await test.notThrowsAsync(pool.ping()) // establishes is ready\n    await pool.kill()\n    await test.notThrowsAsync(pool.ping()) // the pool should recreate killed processes\n  \n  } finally {\n    await pool.end()\n  }\n\n})\n\nTest.skip('WorkerPool.kill() when maximumNumberOfCreate is 0', async (test) => {\n\n  let pool = new WorkerPool({ 'maximumNumberOfCreate': 0, 'numberOfProcess': 2 })\n\n  await test.notThrowsAsync(pool.ping()) // establishes is ready\n  await pool.kill()\n  await test.throwsAsync(pool.ping()) // the pool will not recreate killed processes\n\n})\n\n"],"file":"worker-pool.test.js"}